# 🧠 Ebbinghaus Review (艾宾浩斯复习助手)

> 一个基于艾宾浩斯遗忘曲线的现代化 Android 记忆辅助工具。
> "遗忘是记忆的天敌，而重复是记忆的朋友。"

本项目采用 2025 年主流 Android 技术栈（Kotlin + Compose + Room + MVVM）构建，旨在提供一个科学、高效、体验优雅的复习管理方案。

---

## 📦 模块功能详解 (Features)

### 1. 核心复习系统 (Core Review System)
这是 App 的“大脑”，负责接管你的记忆规划。
*   **科学算法**：内置标准艾宾浩斯 8 阶段复习曲线 (1天, 2天, 4天, 7天, 15天, 30天, 60天, 120天)。
*   **智能防刷机制**：
    *   系统会自动识别“今日已完成”的任务。
    *   如果当前知识点的下次复习时间未到（即今天已打卡），复习页面的按钮会自动变灰（不可点击），防止因重复点击导致算法进度错乱。
*   **复习决策**：
    *   **完成 (Done)**：确认为“记得”，系统自动将阶段 +1，并计算下一次复习时间。
    *   **放弃 (Skip)**：暂不复习，保持当前进度不变，直接返回列表。

### 2. 知识管理与录入 (Knowledge Management)
*   **富媒体支持**：
    *   **图文混排**：支持标题、详情内容、备注描述。
    *   **多图上传**：支持从相册批量选择多张图片，在详情页可横向滑动浏览。
*   **全屏图片查看器**：
    *   在复习页点击图片可进入全屏沉浸模式。
    *   支持**双指缩放 (Pinch-to-Zoom)** 和拖动查看高清细节。
*   **历史回溯**：
    *   在列表页**长按卡片**，弹出复习历史日志。
    *   清晰展示该知识点的每一次复习时间、操作结果（记得/忘了）及阶段变化。

### 3. 首页看板 (Dashboard)
*   **分栏展示**：
    *   **待复习**：实时展示截止当前需要复习的任务。
    *   **今日已学**：展示今天新创建的任务 + 今天已完成复习的任务，给予正向反馈。
*   **交互优化**：
    *   **左滑删除**：支持侧滑删除手势，配有二次确认弹窗，防止误触。

### 4. 每日计划 (Daily Plan)
*   **待办清单**：支持创建每日计划任务，可标记完成或放弃。
*   **防拖延机制**：
    *   进入计划页面时，系统会自动检测昨日未完成的任务。
    *   **强制决策**：弹窗提示用户选择“顺延到今天”或“彻底放弃”，防止任务无限堆积。
*   **进度追踪**：顶部进度条实时展示今日计划完成度。

### 5. 智能规划日历 (Smart Calendar)
*   **未来推演**：不同于普通日历只看历史，本系统的日历支持**复习计划推演**。
*   **逻辑**：点击日历上的未来某一天（例如 7 天后），系统会基于当前所有任务的进度，**实时推算**出那一天将会掉落哪些复习任务，帮助用户提前规划时间。
*   **热力标记**：日历上会自动标记有复习计划的日期。

### 6. 多用户与个性化 (User & Personalization)
*   **多用户支持**：
    *   支持创建多个用户档案，数据隔离。
    *   支持用户快速切换，适合家庭或多场景（如“工作”、“学习”）使用。
*   **个性化设置**：
    *   支持切换深色/浅色壁纸风格。
    *   提供字体大小设置入口（占位）。

### 7. 数据安全与容错 (Data Safety)
*   **回收站机制 (Recycle Bin)**：
    *   删除的知识点不会立即消失，而是进入回收站（软删除）。
    *   支持**一键恢复**或**彻底删除**。
    *   **自动清理**：超过 15 天未恢复的项目会被系统自动永久清除。
*   **JSON 导入导出**：
    *   支持将数据库全量导出为 `.json` 文件。
    *   支持从文件恢复数据，方便跨设备迁移或数据备份。

### 8. 系统级集成 (System Integration)
*   **桌面小部件 (Widget)**：
    *   无需打开 App，在手机桌面即可查看“待复习”数量。
    *   数据实时同步更新。
*   **后台提醒**：基于 WorkManager 的周期性任务，每 15 分钟检查一次到期任务并发送通知。

---

## 🏗 实现思路与技术细节 (Implementation)

### 1. 架构设计 (Architecture)
采用标准的 **MVVM (Model-View-ViewModel)** 架构：
*   **UI Layer**: 完全基于 **Jetpack Compose** (Material Design 3)。无 XML 布局。
*   **ViewModel**: 承载业务逻辑（如算法计算、状态流转），使用 `StateFlow` 驱动 UI 响应式更新。
*   **Data Layer**: 使用 **Room** 作为本地 SQLite 数据库封装，提供 DAO 接口。

### 2. 数据库模型 (Schema)
*   **ReviewItem 表**：
    *   `imagePaths`: 使用 `|` 分隔的字符串存储多张图片路径。
    *   `isDeleted` / `deletedTime`: 标记位，用于实现“软删除”和回收站逻辑。
    *   `nextReviewTime`: 核心字段，存储下一次复习的时间戳。
*   **ReviewLog 表**：
    *   记录每次复习的行为（Action）和时间，用于生成长按历史记录。
*   **PlanItem 表**：
    *   记录每日计划任务，包含内容、日期、状态（待办/完成/放弃）。
*   **User 表**：
    *   记录用户信息，支持多用户切换。

### 3. 关键算法逻辑 (Algorithms)
*   **日历推演 (Calendar Projection)**：
    *   不在数据库层面做复杂的日期查询。
    *   **内存计算**：加载所有活跃任务，针对每个任务循环模拟未来 15 步的复习节点。如果某个模拟节点落在了用户选中的日期范围内，则将其加入展示列表。
*   **防刷逻辑**：
    *   在 UI 层判断 `item.nextReviewTime > System.currentTimeMillis()`。如果是，则说明该任务在未来（即今天已完成），从而禁用复习按钮。
*   **防拖延检查**：
    *   在 `PlanScreen` 启动时，查询所有日期小于今天且状态为 `TODO` 的任务，触发弹窗强制用户处理。

### 4. 交互实现 (UI Interactions)
*   **手势冲突处理**：在 `SwipeToDismissBox` 中，通过 `confirmValueChange` 返回 `false` 并配合 Dialog 状态管理，完美解决了滑动删除与确认弹窗之间的状态冲突问题。
*   **纯 Compose 图片缩放**：使用 `Dialog` 全屏容器配合 `detectTransformGestures` 和 `graphicsLayer`，实现了无第三方重型库依赖的图片缩放功能。

---

## 🛠 技术栈 (Tech Stack)

*   **Language**: Kotlin
*   **UI**: Jetpack Compose (Material3)
*   **Architecture**: MVVM + ViewModel
*   **Database**: Room (SQLite)
*   **Concurrency**: Kotlin Coroutines + Flow
*   **Background**: WorkManager
*   **Image Loading**: Coil
*   **Serialization**: Gson (JSON Export/Import)

---

## 📝 更新日志 (Changelog)

### v1.0.0 (First Release)
- **Core Features**:
  - 实现了完整的艾宾浩斯遗忘曲线算法 (8个阶段)。
  - 首页看板：支持“待复习”与“今日已学”任务的实时展示。
  - 知识录入：支持图文混排、多图上传。
  - 知识详情与复习：支持全屏图片浏览、双指缩放。
  - 历史记录：长按列表项可查看详细复习日志。
- **Plan System**:
  - 每日计划：支持添加、完成、放弃任务。
  - 防拖延机制：自动检测并强制处理过期未完成任务。
- **User Management**:
  - 多用户系统：支持创建、切换不同用户。
  - 个人中心：包含数据管理、个性化设置入口。
- **Advanced Features**:
  - 智能日历：支持基于当前任务推演未来的复习计划，带有热力图标记。
  - 回收站：支持软删除、一键恢复及自动清理过期项目。
  - 数据备份：支持 JSON 格式的全量导入与导出。
- **System Integration**:
  - 桌面 Widget：实时显示待复习数量。
  - 后台提醒：每 15 分钟检查并发送复习通知。
- **UI/UX**:
  - 采用 Material Design 3 风格。
  - 优化了滑动删除、防误触确认等交互体验。
  - 支持深色/浅色壁纸风格切换。

---
*Designed with ❤️ for lifelong learners.*
